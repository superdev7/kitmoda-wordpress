!function(e){var t,a,i={init:function(){e(".fes-form").on("click","img.fes-clone-field",this.cloneField),e(".fes-form").on("click","img.fes-remove-field",this.removeField),e(".fes-submission-form").on("submit",this.formSubmit),e(".fes-form-login-form").on("submit",this.formSubmit),e(".fes-profile-form").on("submit",this.formSubmit),e(".fes-form-registration-form").on("submit",this.formSubmit),e(".fes-form-vendor-contact-form").on("submit",this.formSubmit),e(".fes-fields").on("click","a.fes-feat-image-btn",this.featuredImage.addImage),e(".fes-fields").on("click","a.fes-remove-feat-image",this.featuredImage.removeImage),e(".fes-fields").on("click","a.fes-avatar-image-btn",this.avatarImage.addImage),e(".fes-fields").on("click","a.fes-remove-avatar-image",this.avatarImage.removeImage),e(".fes-fields").on("click","a.upload_file_button",this.fileDownloadable),e(".fes-fields").on("click","a.insert-file-row",function(t){t.preventDefault();var a=e(this).attr("id"),i=e("#fes-upload-max-files-"+a).val(),r=e(".fes-variations-list-"+a),s=r.find(".fes-single-variation:last"),n=s.clone();delete n[1],n.length=1;var o=r.find(".fes-single-variation").length;return o+1>i&&0!=i?alert(fes_form.too_many_files_pt_1+i+fes_form.too_many_files_pt_2):(n.find("input, select, textarea").val(""),n.find("input, select, textarea").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(o)+"]"),e(this).attr("name",t).attr("id",t),n.insertBefore("#"+a)}),!1)}),e(".fes-fields").on("click","a.delete",function(t){t.preventDefault();var a=e(this).parents(".fes-single-variation"),i=e(this).parents("[class^=fes-variations-list-]"),r=i.find(".fes-single-variation").length;return 1==r?alert(fes_form.one_option):(a.remove(),!1)})},avatarImage:{addImage:function(t){t.preventDefault();var i=e(this);return a?void a.open():(a=wp.media({title:fes_form.avatar_title,button:{text:fes_form.avatar_button},library:{type:"image"}}),a.on("select",function(){var e=a.state().get("selection");e.map(function(e){e=e.toJSON(),i.siblings("input.fes-avatar-image-id").val(e.id);var t=i.closest(".instruction-inside"),a=t.siblings(".image-wrap");a.find("img").attr("src",e.url),t.addClass("fes-hide"),a.removeClass("fes-hide")})}),void a.open())},removeImage:function(t){t.preventDefault();var a=e(this),i=a.closest(".image-wrap"),r=i.siblings(".instruction-inside");r.find("input.fes-avatar-image-id").val("0"),i.addClass("fes-hide"),r.removeClass("fes-hide")}},fileDownloadable:function(t){t.preventDefault();var a,i=e(this);return a?void a.open():(a=wp.media({title:fes_form.file_title,button:{text:fes_form.file_button},multiple:!1}),a.on("select",function(){var e=a.state().get("selection");e.map(function(e){e=e.toJSON(),i.closest("tr").find("input.fes-file-value").val(e.url)})}),void a.open())},featuredImage:{addImage:function(a){a.preventDefault();var i=e(this);return t?void t.open():(t=wp.media({title:fes_form.feat_title,button:{text:fes_form.feat_button},library:{type:"image"}}),t.on("select",function(){var e=t.state().get("selection");e.map(function(e){e=e.toJSON(),i.siblings("input.fes-feat-image-id").val(e.id);var t=i.closest(".instruction-inside"),a=t.siblings(".image-wrap");a.find("img").attr("src",e.url),t.addClass("fes-hide"),a.removeClass("fes-hide")})}),void t.open())},removeImage:function(t){t.preventDefault();var a=e(this),i=a.closest(".image-wrap"),r=i.siblings(".instruction-inside");r.find("input.fes-feat-image-id").val("0"),i.addClass("fes-hide"),r.removeClass("fes-hide")}},cloneField:function(t){t.preventDefault();var a=e(this).closest("tr"),i=a.clone(),r=a.parent().find("tr"),s=highest=0;r.each(function(){var t=e(this).data("key");parseInt(t)>highest&&(highest=t)}),s=highest+1,i.attr("data-key",parseInt(s)),i.find(":checked").attr("checked",""),i.find("input, select, textarea").val(""),i.find("input, select, textarea").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(s)+"]"),e(this).attr("name",t).attr("id",t)}),a.after(i)},removeField:function(){var t=e(this).closest("tr"),a=t.siblings().andSelf().length;a>1&&t.remove()},formSubmit:function(t){t.preventDefault();var a=e(this),r=a.find(".fes-form-error");submitButton=a.find("input[type=submit]"),form_data=i.validateForm(a),r.length&&r.hide(),form_data&&(a.find("fieldset.fes-submit").append('<span class="fes-loading"></span>'),submitButton.attr("disabled","disabled").addClass("button-primary-disabled"),e.post(fes_form.ajaxurl,form_data,function(t){window.console&&window.console.log&&console.log(t),t.success?(a.before('<div class="fes-success">'+t.message+"</div>"),t.is_post&&a.slideUp("fast",function(){a.remove()}),e("html, body").animate({scrollTop:e(".fes-success").offset().top-100},"fast"),setTimeout(function(){window.location=t.redirect_to},1e3)):(r.length?(r.text(t.error),r.show()):alert(t.error),submitButton.removeAttr("disabled")),submitButton.removeClass("button-primary-disabled"),a.find("span.fes-loading").remove()}))},validateForm:function(t){var a,r=!1;i.removeErrors(t),i.removeErrorNotice(t);var s=t.find('[data-required="yes"]');if(s.each(function(t,a){var s=e(a).data("type");switch(f="",s){case"rich":var n=e(a).data("id");f=e.trim(tinyMCE.get(n).getContent()),""===f&&(r=!0,i.markError(a));break;case"textarea":case"text":f=e.trim(e(a).val()),""===f&&(r=!0,i.markError(a));break;case"select":f=e(a).val(),f&&"-1"!==f||(r=!0,i.markError(a));break;case"multiselect":f=e(a).val(),(null===f||0===f.length)&&(r=!0,i.markError(a));break;case"tax-checkbox":var o=e(a).children().find("input:checked").length;o||(r=!0,i.markError(a));break;case"radio":var o=e(a).parent().find("input:checked").length;o||(r=!0,i.markError(a));break;case"image":var o=e(a).next().val();(null===o||0===o||""===o||"0"===o)&&(r=!0,i.markError(a));break;case"file":var o=e(a).next("input.fes-file-value").val();null===o||0===o||""===o?(r=!0,i.markError(a)):i.isValidURL(o)||(r=!0,i.markError(a));break;case"email":var f=e(a).val();""!==f&&(i.isValidEmail(f)||(r=!0,i.markError(a)));break;case"url":var f=e(a).val();""!==f&&(i.isValidURL(f)||(r=!0,i.markError(a)));break;case"checkbox":var o=e(a).parent().find("input:checked").length;o||(r=!0,i.markError(a));break;case"multiple":var l=e(a).closest(".fes-single-variation").find("input.fes-file-value").val(),u=e(a).closest(".fes-single-variation").find("input.fes-price-value").val(),n=e(a).closest(".fes-single-variation").find("input.fes-name-value").val(),d=!1;e("#fes-file-row-js").length&&(d=!0);var m=!1;e("#fes-price-row-js").length&&(m=!0);var c=!1;e("#fes-name-row-js").length&&(c=!0),!d||""!==l&&i.isValidURL(l)||(r=!0,i.markError(a)),m&&""===u&&(r=!0,i.markError(a)),c&&""===n&&(r=!0,i.markError(a))}}),r)return i.addErrorNotice(t),!1;var n=t.serialize(),o=[];return e(".fes-rich-validation").each(function(t,i){a=e(i).data("id"),val=e.trim(tinyMCE.get(a).getContent()),o.push(a+"="+encodeURIComponent(val))}),n=n+"&"+o.join("&")},addErrorNotice:function(t){e(t).find("fieldset.fes-submit").append('<div id="fes-error-div" class="fes-error edd_errors">'+fes_form.error_message+"</div>")},removeErrorNotice:function(t){e(t).find("#fes-error-div").remove()},markError:function(t){e(t).closest("fieldset").addClass("has-error"),e(t).focus()},removeErrors:function(t){e(t).find(".has-error").removeClass("has-error")},isValidEmail:function(e){var t=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return t.test(e)},isValidURL:function(e){var t=new RegExp("^(http://www.|https://www.|files.|ftp://www.|www.|http://|https://){1}([0-9A-Za-z]+.)|.+.(?:"+fes_form.file_types+")");return t.test(e)}};e(function(){i.init()})}(jQuery);